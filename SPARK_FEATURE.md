# 🔥 火花功能说明文档

## 功能概述

"火花 Spark" 是星河情书工作室推出的情侣互动功能,灵感来自抖音等社交平台的火花机制。通过持续对区块链的贡献来维持双方的"数字之火",增强情侣间的互动粘性。

## 核心机制

### 1. 配对点燃
- **配对串 (Pairing String)**: 情侣双方约定的唯一字符串,用于身份验证
- **密钥对绑定**: 使用同一配对串生成的两个密钥对进行绑定
- **双向验证**: 可选填写对方的公钥指纹进行配对验证

### 2. 火花持续时间
初始状态下,火花有24小时的基础持续时间。通过以下贡献方式可以延长:

| 贡献类型 | 延长时间 | 触发方式 |
|---------|---------|---------|
| 💌 发送情书 | +24小时 | 在"情书炼金术"面板发送情书 |
| 🔄 同步区块 | +6小时 | 点击同步按钮或Dock栏同步 |
| 🔑 创建密钥 | +12小时 | 在"密钥工坊"创建新密钥对 |
| 💎 续燃Premium | +7天 | 即将推出的高级功能 |

### 3. 火花等级系统

根据连续燃烧天数提升等级:

- **Lv.0**: 未点燃
- **Lv.1**: 连续7天 🔥
- **Lv.2**: 连续30天 🔥🔥
- **Lv.3**: 连续100天 🔥🔥🔥
- **Lv.Max**: 连续365天 🔥🔥🔥🔥

高等级火花解锁特殊视觉效果和专属勋章。

## UI 功能

### 火花面板 (panel-spark)

#### 火花状态卡片
- **视觉火焰**: 三层火焰动画(核心层、中层、外层),燃烧时展现流动效果
- **天数显示**: 实时显示连续燃烧天数
- **等级徽章**: 显示当前火花等级
- **进度条**: 24小时剩余时间进度条
- **配对信息**: 显示配对串、配对密钥、剩余时间等元数据

#### 火花配对表单
- 选择本地密钥
- 输入配对串
- (可选)输入对方公钥指纹
- 点击"点燃火花"按钮完成配对

#### 续火花操作
四种快捷操作卡片:
1. 发送情书 (+24h)
2. 同步区块 (+6h)
3. 创建密钥 (+12h)
4. 续燃Premium (+7天,即将推出)

#### 贡献历史
展示所有延长火花持续时间的历史记录,包括:
- 贡献类型
- 增加的时间
- 时间戳

### Dock栏集成

底部macOS风格Dock栏包含:
- 🏠 首页
- 🔥 火花 (显示燃烧天数徽章)
- ✍️ 撰写情书
- 📚 情书库
- 分隔线
- 🔄 同步
- 🕶️ Tor隧道
- 分隔线
- 🚀 启动器

特性:
- 悬停放大动画
- 点击波纹效果
- 实时状态徽章更新
- 玻璃态模糊背景
- 响应式设计

### 启动器面板 (panel-launcher)

网格布局展示所有应用功能:
- 🔥 火花 Spark (NEW标识)
- 🔑 密钥工坊
- ✍️ 情书炼金术
- 📚 星辰图书馆
- 🌐 中继星图
- 🕶️ 暗网穿梭机

每个卡片包含图标、标题、描述,悬停时触发3D提升效果。

## 快捷键

- `Esc`: 返回首页
- `Ctrl+L` / `Cmd+L`: 打开启动器

## API端点 (前端期望)

以下是前端已实现的API调用,后端需要实现对应端点:

### GET /api/spark/status
获取火花状态

**响应示例**:
```json
{
  "active": true,
  "days": 15,
  "level": 1,
  "remainingHours": 18.5,
  "pairString": "love-forever-2024",
  "partnerKeyId": "abc123...",
  "keyId": "xyz789...",
  "contributions": [
    {
      "type": "letter",
      "hours": 24,
      "timestamp": "2024-11-15T08:00:00Z"
    }
  ]
}
```

### POST /api/spark/pair
点燃火花/配对

**请求体**:
```json
{
  "keyId": "本地密钥ID",
  "pairString": "配对串",
  "partnerKeyId": "对方公钥ID(可选)"
}
```

**响应**:
```json
{
  "success": true,
  "message": "火花已点燃"
}
```

### POST /api/spark/contribute
增加火花贡献

**请求体**:
```json
{
  "type": "letter|sync|key|premium",
  "hours": 24
}
```

**响应**:
```json
{
  "success": true,
  "newRemainingHours": 42.5
}
```

## 动画效果

### 火焰动画
- `flame-flicker`: 火焰闪烁效果(2-2.7秒周期)
- 三层火焰独立动画,延迟错开
- 燃烧时opacity从0.3提升至0.5-1.0

### 火花图标
- `spark-flicker`: 图标闪烁旋转(2秒周期)
- 色彩渐变: 金色 ↔ 玫瑰红
- 阴影脉冲: 6px-16px drop-shadow

### 升级动画
- `spark-level-up`: 等级提升时触发
- 2秒旋转720度
- 亮度增强至3倍
- 阴影爆发至50px

### Dock栏动画
- `dock-bounce-in`: 初始入场弹跳动画
- 悬停时translateY(-12px) + scale(1.15)
- 点击波纹ripple-out效果

## 样式变量

新增CSS变量:
```css
--gold-ember: #fbbf24;  /* 火花金色 */
```

## 设计理念

1. **游戏化互动**: 通过可视化进度和等级系统激励用户持续使用
2. **情侣专属**: 配对串机制确保火花的独特性和私密性
3. **贡献奖励**: 将日常操作转化为有意义的互动仪式
4. **视觉反馈**: 流动的火焰、渐变色彩、升级特效提供即时满足感
5. **社交粘性**: 连续天数记录和等级系统增强长期留存

## 技术栈

- **前端**: 原生JavaScript ES6 Modules
- **样式**: CSS3动画、@keyframes、backdrop-filter
- **架构**: 模块化组件(navigation.js, animations.js, app.js)
- **数据**: LocalStorage持久化(后端实现后迁移至API)

## 后续优化方向

1. 实现后端API(目前前端已完整实现)
2. 添加推送通知(火花即将熄灭提醒)
3. 火花历史数据可视化(图表展示贡献趋势)
4. 社交分享功能(分享火花里程碑)
5. Premium续燃套餐(7天/30天自动续费)
6. 火花排行榜(全球最长连续天数)
7. 特殊日期奖励(纪念日、情人节双倍贡献)
8. 火花主题皮肤(不同颜色/形态的火焰)

---

**版本**: v1.0.0  
**更新时间**: 2025-11-15  
**状态**: 前端已完成,等待后端API实现
